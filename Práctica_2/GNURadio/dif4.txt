import numpy as np
from gnuradio import gr

class blk(gr.sync_block):
    def __init__(self):
        gr.sync_block.__init__(
            self,
            name='e_Diff',            # Nombre en GRC
            in_sig=[np.float32],      # Entrada float
            out_sig=[np.float32],     # Salida float
        )
        self.prev = 0.0              # último valor del vector anterior

    def work(self, input_items, output_items):
        x = input_items[0]   # Señal de entrada (vector)
        y0 = output_items[0] # Señal de salida (diferencial)

        if len(x) == 0:
            return 0

        # Primer valor: diferencia contra el último valor anterior
        y0[0] = x[0] - self.prev

        # Diferencias internas del vector
        if len(x) > 1:
            y0[1:] = x[1:] - x[:-1]

        # Guardar último valor para el siguiente bloque de datos
        self.prev = x[-1]

        return len(y0)
